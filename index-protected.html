<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="robots" content="noindex, nofollow">
    <title>Password Protected Page</title>
    <style>
        html, body {
            margin: 0;
            width: 100%;
            height: 100%;
            font-family: Arial, Helvetica, sans-serif;
        }
        #dialogText {
            color: white;
            background-color: #333333;
        }
        
        #dialogWrap {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: table;
            background-color: #EEEEEE;
        }
        
        #dialogWrapCell {
            display: table-cell;
            text-align: center;
            vertical-align: middle;
        }
        
        #mainDialog {
            max-width: 400px;
            margin: 5px;
            border: solid #AAAAAA 1px;
            border-radius: 10px;
            box-shadow: 3px 3px 5px 3px #AAAAAA;
            margin-left: auto;
            margin-right: auto;
            background-color: #FFFFFF;
            overflow: hidden;
            text-align: left;
        }
        #mainDialog > * {
            padding: 10px 30px;
        }
        #passArea {
            padding: 20px 30px;
            background-color: white;
        }
        #passArea > * {
            margin: 5px auto;
        }
        #pass {
            width: 100%;
            height: 40px;
            font-size: 30px;
        }
        
        #messageWrapper {
            float: left;
            vertical-align: middle;
            line-height: 30px;
        }
        
        .notifyText {
            display: none;
        }
        
        #invalidPass {
            color: red;
        }
        
        #success {
            color: green;
        }
        
        #submitPass {
            font-size: 20px;
            border-radius: 5px;
            background-color: #E7E7E7;
            border: solid gray 1px;
            float: right;
            cursor: pointer;
        }
        #contentFrame {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        #attribution {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            text-align: center;
            padding: 10px;
            font-weight: bold;
            font-size: 0.8em;
        }
        #attribution, #attribution a {
            color: #999;
        }
        .error {
            display: none;
            color: red;
        }
    </style>
  </head>
  <body>
    <iframe id="contentFrame" frameBorder="0" allowfullscreen></iframe>
    <div id="dialogWrap">
        <div id="dialogWrapCell">
            <div id="mainDialog">
                <div id="dialogText">This page is password protected.</div>
                <div id="passArea">
                    <p id="passwordPrompt">Password</p>
                    <input id="pass" type="password" name="pass" autofocus>
                    <div>
                        <span id="messageWrapper">
                            <span id="invalidPass" class="error">Sorry, please try again.</span>
                            <span id="trycatcherror" class="error">Sorry, something went wrong.</span>
                            <span id="success" class="notifyText">Success!</span>
                            &nbsp;
                        </span>
                        <button id="submitPass" type="button">Submit</button>
                        <div style="clear: both;"></div>
                    </div>
                </div>
                <div id="securecontext" class="error">
                    <p>
                        Sorry, but password protection only works over a secure connection. Please load this page via HTTPS.
                    </p>
                </div>
                <div id="nocrypto" class="error">
                    <p>
                        Your web browser appears to be outdated. Please visit this page using a modern browser.
                    </p>
                </div>
            </div>
        </div>
    </div>
    <div id="attribution">
        Protected by <a href="https://www.maxlaumeister.com/pagecrypt/">PageCrypt</a>
    </div>
    <script>
    (function() {

        var pl = "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";
        
        var submitPass = document.getElementById('submitPass');
        var passEl = document.getElementById('pass');
        var invalidPassEl = document.getElementById('invalidPass');
        var trycatcherror = document.getElementById('trycatcherror');
        var successEl = document.getElementById('success');
        var contentFrame = document.getElementById('contentFrame');
        
        // Sanity checks

        if (pl === "") {
            submitPass.disabled = true;
            passEl.disabled = true;
            alert("This page is meant to be used with the encryption tool. It doesn't work standalone.");
            return;
        }

        if (!isSecureContext) {
            document.querySelector("#passArea").style.display = "none";
            document.querySelector("#securecontext").style.display = "block";
            return;
        }

        if (!crypto.subtle) {
            document.querySelector("#passArea").style.display = "none";
            document.querySelector("#nocrypto").style.display = "block";
            return;
        }
        
        function str2ab(str) {
            var ustr = atob(str);
            var buf = new ArrayBuffer(ustr.length);
            var bufView = new Uint8Array(buf);
            for (var i=0, strLen=ustr.length; i < strLen; i++) {
                bufView[i] = ustr.charCodeAt(i);
            }
            return bufView;
        }

        async function deriveKey(salt, password) {
            const encoder = new TextEncoder()
            const baseKey = await crypto.subtle.importKey(
                'raw',
                encoder.encode(password),
                'PBKDF2',
                false,
                ['deriveKey'],
            )
            return await crypto.subtle.deriveKey(
                { name: 'PBKDF2', salt, iterations: 100000, hash: 'SHA-256' },
                baseKey,
                { name: 'AES-GCM', length: 256 },
                true,
                ['decrypt'],
            )
        }
        
        async function doSubmit(evt) {
            submitPass.disabled = true;
            passEl.disabled = true;

            let iv, ciphertext, key;
            
            try {
                var unencodedPl = str2ab(pl);

                const salt = unencodedPl.slice(0, 32)
                iv = unencodedPl.slice(32, 32 + 16)
                ciphertext = unencodedPl.slice(32 + 16)

                key = await deriveKey(salt, passEl.value);
            } catch (e) {
                trycatcherror.style.display = "inline";
                console.error(e);
                return;
            }

            try {
                const decryptedArray = new Uint8Array(
                    await crypto.subtle.decrypt({ name: 'AES-GCM', iv }, key, ciphertext)
                );

                let decrypted = new TextDecoder().decode(decryptedArray);

                if (decrypted === "") throw "No data returned";

                const basestr = '<base href="." target="_top">';
                const anchorfixstr = `
                    <script>
                        Array.from(document.links).forEach((anchor) => {
                            const href = anchor.getAttribute("href");
                            if (href.startsWith("#")) {
                                anchor.addEventListener("click", function(e) {
                                    e.preventDefault();
                                    const targetId = this.getAttribute("href").substring(1);
                                    const targetEl = document.getElementById(targetId);
                                    targetEl.scrollIntoView();
                                });
                            }
                        });
                    <\/script>
                `;
                
                // Set default iframe link targets to _top so all links break out of the iframe
                if (decrypted.includes("<head>")) decrypted = decrypted.replace("<head>", "<head>" + basestr);
                else if (decrypted.includes("<!DOCTYPE html>")) decrypted = decrypted.replace("<!DOCTYPE html>", "<!DOCTYPE html>" + basestr);
                else decrypted = basestr + decrypted;

                // Fix fragment links
                if (decrypted.includes("</body>")) decrypted = decrypted.replace("</body>", anchorfixstr + '</body>');
                else if (decrypted.includes("</html>")) decrypted = decrypted.replace("</html>", anchorfixstr + '</html>');
                else decrypted = decrypted + anchorfixstr;
                
                contentFrame.srcdoc = decrypted;
                
                successEl.style.display = "inline";
                setTimeout(function() {
                    dialogWrap.style.display = "none";
                }, 1000);
            } catch (e) {
                invalidPassEl.style.display = "inline";
                passEl.value = "";
                submitPass.disabled = false;
                passEl.disabled = false;
                console.error(e);
                return;
            }
        }
        
        submitPass.onclick = doSubmit;
        passEl.onkeypress = function(e){
            if (!e) e = window.event;
            var keyCode = e.keyCode || e.which;
            invalidPassEl.style.display = "none";
            if (keyCode == '13'){
              // Enter pressed
              doSubmit();
              return false;
            }
        }
    })();
    </script>
  </body>
</html>
